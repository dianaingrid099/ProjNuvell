<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprar | Nuvell</title>
    <link rel="stylesheet" href="assets/css/page/Venda/venda.css">
    <link href='https://fonts.googleapis.com/css?family=League Spartan' rel='stylesheet'>
    <script src="https://kit.fontawesome.com/81389dc184.js" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
        crossorigin="anonymous"></script>
</head>

<body>

    <header>

        <nav>

            <a href="index.html" class="icon-logo">
                <i class="fa-solid fa-paw"></i>
                <h2> Nuvell</h2>
            </a>

            <section class="navbar-texto">
                <a href="index.html">Pelúcias</a>
                <a href="colecao.html">Coleções</a>
            </section>

            <div class="icons">
                <a id="abrir-carrinho" href="#"><i class="fa-solid fa-cart-shopping btn-compra"></i></a>
                <a href="login.html"><button class="btn-entrar">Entrar</button></a>
            </div>

        </nav>

    </header>

    <section id="carrinho" class="position-fixed top-0  bg-light text-dark p-4"
        style="width: 360px; height: 100vh; right: -360px; transition: right 0.2s; z-index: 1050; display: flex; flex-direction: column; justify-content: space-between;">
        <div class="d-flex justify-content-between mb-4">
            <p class="h4">Meu carrinho</p>
            <button id="fechar-carrinho" class="btn btn-sm btn-outline-dark">✖</button>
        </div>

        <section id="produtos-carrinho" class="overflow-auto flex-grow-1 mb-3" style="max-height: 60vh;"></section>

        <p class="h5" id="preco-total">Total: R$0</p>
        <a href="./compra.html" id="finalizar-compra"><button class="btn btn-dark text-light mt-2" >Finalizar Compra</button> </a> 
    </section>

    <section class="produto">
        <div class="container">
            <div class="gallery">

                <div class="main-image">
                    <img src="" id="imagem-produto" alt="">
                </div>
            </div>
            <div class="product-info">
                <h1></h1>
                <p class="price">R$ 89,90 - 110,00</p>
                <p class="texto-tamanho">Tamanho</p>
                <select id="size">
                    <option value="small">Pequeno</option>
                    <option value="medium">Médio</option>
                    <option value="large">Grande</option>
                </select>

                <div class="actions">
                    <div class="quantity-selector">
                        <button id="btn-minus">-</button>
                        <input type="number" id="counter" value="1" min="1" max="100" step="1">
                        <button id="btn-plus">+</button>
                    </div>
                    <button class="buy-button">Comprar</button>
                </div>
            </div>
        </div>

        <div class="description">
            <div class="description-content">
                <p class="description-titulo">Descrição </p>
                <p class="description-texto">Delicada, fofa e irresistivelmente macia, nossas pelúcias são a
                    companheira
                    ideal para quem ama conforto e ternura. Com pelagem fofa, olhos expressivos e um jeitinho
                    sereno,
                    ela transmite calma e carinho em cada detalhe. Perfeito para crianças, amantes de pelúcias ou para
                    dar um
                    toque acolhedor.</p>
            </div>
        </div>



    </section>

    <section class="sobre">

        <div class="conteudo-sobre">

            <h1>Sobre a Nuvell</h1>

            <div class="sobre-coluna">

                <div class="coluna1 coluna">

                    <div>
                        <i class="fa-solid fa-globe"></i>
                        <h2 class="sobre-titulo">Sobre</h2>
                    </div>

                    <p>Na Nuvell, cada bichinho é muito mais do que um simples brinquedo — é um verdadeiro companheiro,
                        cheio de personalidade e fofura. Criados com carinho em cada detalhe, eles são feitos para
                        despertar sorrisos, aquecer corações e transformar momentos comuns em lembranças especiais. Seja
                        para presentear alguém querido ou para ter sempre por perto, nossos bichinhos carregam consigo
                        um toque de magia, prontos para fazer parte das suas histórias e viver grandes aventuras ao seu
                        lado.
                    </p>

                </div>

                <div class="coluna2 coluna">

                    <div>
                        <i class="fa-solid fa-circle-user"></i>
                        <h2 class="sobre-titulo">Conheça mais !</h2>
                    </div>

                    <p>Visite nosso espaço físico ou acesse nosso site e mergulhe de cabeça no encantador universo dos
                        bichos de pelúcia! Aqui, cada cantinho foi pensado para despertar a imaginação e aquecer o
                        coração. Descubra coleções exclusivas, criadas com todo o carinho para trazer alegria em cada
                        detalhe. Aproveite promoções especiais, pensadas para tornar seu momento de compra ainda mais
                        mágico, e fique por dentro das novidades que chegam a cada temporada, sempre trazendo novos
                        personagens, cores e histórias.
                    </p>

                </div>

            </div>

        </div>

    </section>

    <footer>

        <div class="conteudo-footer">
            <div class="midias">

                <div class="logo-footer">
                    <i class="fa-solid fa-paw"></i>
                    <h2> Nuvell</h2>
                </div>

                <div class="midias-footer">
                    <a href="#"><i class="fa-brands fa-facebook"></i></a>
                    <a href="#"><i class="fa-brands fa-linkedin"></i></a>
                    <a href="#"><i class="fa-brands fa-youtube"></i></a>
                    <a href="#"><i class="fa-brands fa-square-instagram"></i></a>
                </div>

            </div>

            <div class="notas">

                <div class="notas-coluna1 notas-coluna">

                    <h4>Produtos</h4>

                    <a class="texto-coluna" href="#">
                        <p>Novidades</p>
                    </a>
                    <a class="texto-coluna" href="#">
                        <p>Mais Vendidos</p>
                    </a>
                    <a class="texto-coluna" href="#">
                        <p>Personalizados</p>
                    </a>

                </div>

                <div class="notas-coluna2 notas-coluna">

                    <h4>Ajuda</h4>

                    <a class="texto-coluna" href="#">
                        <p>Troca e Devoluções</p>
                    </a>
                    <a class="texto-coluna" href="#">
                        <p>Suporte Cliente</p>
                    </a>
                    <a class="texto-coluna" href="#">
                        <p>Rastreamento</p>
                    </a>

                </div>

                <div class="notas-coluna3 notas-coluna">

                    <h4>Sobre</h4>

                    <a class="texto-coluna" href="#">
                        <p>Quem Somos</p>
                    </a>
                    <a class="texto-coluna" href="#">
                        <p>Nossa Missão</p>
                    </a>
                    <a class="texto-coluna" href="#">
                        <p>Sustentabilidade</p>
                    </a>

                </div>

            </div>
        </div>

    </footer>
    <script src="assets/css/global/script.js"></script>
    <script>
        // Captura o ID da URL
        const urlParams = new URLSearchParams(window.location.search);
        const produtoId = urlParams.get('id');
        let produtoNome = "";

        window.addEventListener("DOMContentLoaded", () => {
            console.log("carregou o dom")
            const baseUrl = "http://localhost:5050"
            getProduto(produtoId);

            function getProduto(id) {
                console.log("caiu na getprodutobyid")

                try {
                    const response = fetch(`${baseUrl}/getProdutoById/${id}`)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Erro na resposta: ' + response.status);
                            }
                            return response.json(); // transforma a resposta em JSON
                        })
                        .then(produto => preencheDadosDoProduto(produto));
                } catch (e) {
                    console.log(e);
                }
            }

            function preencheDadosDoProduto(produto) {

                const nomeProduto = produto.nome.replace("-", " ");
                produtoNome = nomeProduto;

                // Preenche os dados do produto
                if (produto) {
                    titulo.textContent = nomeProduto;
                    img.src = `assets/css/global/Pelucias/${produto.nome}.png`;
                    img.alt = `Imagem de ${produto.nome}`;
                    updateTotal();
                } else {
                    titulo.textContent = "Produto não encontrado";
                    img.style.display = 'none';
                }

            }
        });

        // Referência dos elementos
        const img = document.getElementById('imagem-produto');
        const titulo = document.querySelector('.product-info h1');
        const priceEl = document.querySelector('.price');
        const sizeSelect = document.getElementById('size');
        const inputQty = document.getElementById('counter');
        const btnMinus = document.getElementById('btn-minus');
        const btnPlus = document.getElementById('btn-plus');
        const btnComprar = document.querySelector('.buy-button');

        // Mapeamento de preços por tamanho
        const priceMap = {
            small: 89.90,
            medium: 99.90,
            large: 110.00
        };

        // Função de formatação BRL
        function formatBRL(value) {
            return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }

        // Atualiza o preço total
        function updateTotal() {
            const size = sizeSelect.value;
            const unitPrice = priceMap[size];
            const quantity = parseInt(inputQty.value);
            const total = unitPrice * quantity;
            priceEl.textContent = formatBRL(total);
        }

        // Eventos dos botões
        btnMinus.addEventListener('click', () => {
            let qty = parseInt(inputQty.value);
            if (qty > 1) {
                inputQty.value = qty - 1;
                updateTotal();
            }
        });

        btnPlus.addEventListener('click', () => {
            let qty = parseInt(inputQty.value);
            if (qty < 100) {
                inputQty.value = qty + 1;
                updateTotal();
            }
        });

        sizeSelect.addEventListener('change', updateTotal);

        btnComprar.addEventListener('click', () => {
            console.log("caiu no comprar produto");
            const size = sizeSelect.value;
            const unitPrice = priceMap[size];
            const quantity = parseInt(inputQty.value);
            const total = unitPrice * quantity;


            const produto = {
                Nome: produtoNome,
                Id: produtoId,
                Quantidade: quantity,
                PrecoUnitario: unitPrice
            };
            console.log(produto);


            let carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];
            const produtoExistente = carrinho.find(p => p.Id === produto.Id);

            if (produtoExistente) {
                produtoExistente.Quantidade += produto.Quantidade;
            } else {
                carrinho.push(produto);
            }

            localStorage.setItem("carrinho", JSON.stringify(carrinho));
            atualizarCarrinho();

            console.log('Pedido salvo no localStorage!');
        });
        inputQty.addEventListener('input', () => {
            let valor = parseInt(inputQty.value);

            if (isNaN(valor) || valor < 1) {
                valor = 1;
            } else if (valor > 100) {
                valor = 100;
            }

            inputQty.value = valor;
            updateTotal();
        });

        function atualizarCarrinho() {
            const produtosCarrinho = document.getElementById('produtos-carrinho');
            const precoTotal = document.getElementById('preco-total');

            console.log("Atualizou carrinho");
            const itens = JSON.parse(localStorage.getItem('carrinho')) || [];

            produtosCarrinho.innerHTML = '';
            let total = 0;
            itens.forEach(produto => {
                console.log(produto);
                const div = document.createElement('div');
                div.classList.add('mb-2');
                div.innerHTML = `
      <strong>${produto.Nome}</strong> - R$${produto.PrecoUnitario.toFixed(2)}_____Quantidade: ${produto.Quantidade}
    `;
                produtosCarrinho.appendChild(div);
                total += (produto.PrecoUnitario * produto.Quantidade);
            });

            precoTotal.innerText = `Total: R$${total.toFixed(2)}`;
        }
    </script>

    <!-- Bootstrap JS + seu script de carrinho -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="./JavaScript/carrinho.js"></script>

</body>